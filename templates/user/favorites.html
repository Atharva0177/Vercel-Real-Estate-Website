{% extends 'base.html' %}

{% block title %}My Favorites - Premium Real Estate{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>My <span class="highlight">Favorites</span></h1>
        <p>Properties you've saved for later</p>
    </div>
</section>

<section class="section">
    <div class="container">
        {% if favorites %}
        <div class="results-info">
            <p>You have <strong>{{ favorites|length }}</strong> favorite properties</p>
        </div>
        
        <div class="properties-grid">
            {% for favorite in favorites %}
            <div class="property-card fade-in-up">
                <div class="property-image">
                    {% if favorite.property.images %}
                        <img src="{{ url_for('static', filename=favorite.property.images[0].image_url) }}" alt="{{ favorite.property.title }}">
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?w=800" alt="{{ favorite.property.title }}">
                    {% endif %}
                    
                    {% if favorite.property.status == 'Available' %}
                        <div class="property-badge">Available</div>
                    {% elif favorite.property.status == 'Reserved' %}
                        <div class="property-badge reserved">Reserved</div>
                    {% elif favorite.property.status == 'Sold' %}
                        <div class="property-badge sold">Sold</div>
                    {% endif %}
                    
                    <div class="property-overlay">
                        <a href="{{ url_for('property_detail', id=favorite.property.id) }}" class="btn btn-white">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                    </div>
                </div>
                <div class="property-content">
                    <div class="property-type">
                        <i class="fas fa-tag"></i> {{ favorite.property.property_type }}
                    </div>
                    <h3>{{ favorite.property.title }}</h3>
                    <p>{{ favorite.property.description[:100] }}...</p>
                    <div class="property-details">
                        <span><i class="fas fa-map-marker-alt"></i> {{ favorite.property.location }}</span>
                        <span><i class="fas fa-ruler-combined"></i> {{ favorite.property.area|int }} sq ft</span>
                    </div>
                    <div class="property-footer">
                        <div class="property-price">
                            <span class="price">â‚¹{{ "{:,.0f}".format(favorite.property.price) }}</span>
                        </div>
                        <button onclick="removeFavorite({{ favorite.property.id }}, this)" class="btn-link" style="color: var(--danger);">
                            <i class="fas fa-heart"></i> Remove
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-results">
            <i class="fas fa-heart-broken"></i>
            <h3>No Favorites Yet</h3>
            <p>Start adding properties to your favorites to see them here!</p>
            <a href="{{ url_for('properties') }}" class="btn btn-primary btn-lg" style="margin-top: 2rem;">
                <i class="fas fa-search"></i> Browse Properties
            </a>
        </div>
        {% endif %}
    </div>
</section>

<style>
/* Additional styles for favorites page */
.results-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    text-align: center;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
}

.results-info p {
    margin: 0;
    font-size: 1.1rem;
}

.results-info strong {
    font-size: 1.3rem;
    color: #fff;
}

.btn-link {
    transition: all 0.3s ease;
}

.btn-link:hover {
    transform: scale(1.1);
}
</style>

<script>
function removeFavorite(propertyId, button) {
    if (confirm('Remove this property from favorites?')) {
        fetch('/favorite/toggle/' + propertyId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            // Remove the property card with animation
            const card = button.closest('.property-card');
            card.style.transition = 'all 0.5s ease';
            card.style.transform = 'scale(0)';
            card.style.opacity = '0';
            
            setTimeout(() => {
                location.reload();
            }, 500);
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to remove favorite. Please try again.');
        });
    }
}
</script>
{% endblock %}