{% extends 'base.html' %}
{% block title %}Admin Dashboard - Premium Real Estate{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}
{% block content %}
<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="sidebar-header"><i class="fas fa-user-shield"></i><span>Admin Panel</span></div>
    <nav class="sidebar-nav">
      <a href="{{ url_for('admin_dashboard') }}" class="nav-item active"><i class="fas fa-chart-line"></i> Dashboard</a>
      <a href="{{ url_for('admin_properties') }}" class="nav-item"><i class="fas fa-building"></i> Properties</a>
      <a href="{{ url_for('admin_add_property') }}" class="nav-item"><i class="fas fa-plus-circle"></i> Add Property</a>
      <a href="{{ url_for('admin_enquiries') }}" class="nav-item"><i class="fas fa-envelope"></i> Enquiries</a>
      <a href="{{ url_for('admin_bookings') }}" class="nav-item"><i class="fas fa-calendar-check"></i> Bookings</a>
      <a href="{{ url_for('index') }}" class="nav-item"><i class="fas fa-globe"></i> View Website</a>
      <a href="{{ url_for('admin_logout') }}" class="nav-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </aside>

  <main class="admin-main">
    <div class="admin-header">
      <h1>Dashboard</h1>
      <div class="admin-user"><i class="fas fa-user-circle"></i><span>{{ session.admin_username }}</span></div>
    </div>

    <div class="admin-content">
      <div class="stats-grid">
        <div class="stat-card blue"><div class="stat-icon"><i class="fas fa-building"></i></div><div class="stat-details"><h3>{{ stats.total }}</h3><p>Total Properties</p></div></div>
        <div class="stat-card green"><div class="stat-icon"><i class="fas fa-check-circle"></i></div><div class="stat-details"><h3>{{ stats.available }}</h3><p>Available</p></div></div>
        <div class="stat-card orange"><div class="stat-icon"><i class="fas fa-handshake"></i></div><div class="stat-details"><h3>{{ stats.sold }}</h3><p>Sold</p></div></div>
        <div class="stat-card purple"><div class="stat-icon"><i class="fas fa-envelope"></i></div><div class="stat-details"><h3>{{ stats.enquiries }}</h3><p>New Enquiries</p></div></div>
        <div class="stat-card teal"><div class="stat-icon"><i class="fas fa-calendar-check"></i></div><div class="stat-details"><h3>{{ stats.bookings }}</h3><p>Pending Visits</p></div></div>
      </div>

      <div class="dashboard-section">
        <div class="section-header">
          <h2>Recent Properties</h2>
          <a href="{{ url_for('admin_properties') }}" class="btn btn-secondary">View All</a>
        </div>
        <div class="table-responsive">
          <table class="admin-table">
            <thead><tr><th>Title</th><th>Type</th><th>Location</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
            <tbody>
              {% if properties and properties|length > 0 %}
                {% for property in properties %}
                <tr>
                  <td>{{ property.title }}</td>
                  <td>{{ property.property_type }}</td>
                  <td>{{ property.location }}</td>
                  <td>{{ property.status }}</td>
                  <td>{{ property.created_at.strftime('%d %b %Y') }}</td>
                  <td>
                    <div class="action-buttons">
                      <a href="{{ url_for('property_detail', id=property.id) }}" class="btn-icon" title="View"><i class="fas fa-eye"></i></a>
                      <a href="{{ url_for('admin_edit_property', id=property.id) }}" class="btn-icon" title="Edit"><i class="fas fa-edit"></i></a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="6" style="text-align:center;color:#777;">No recent properties.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="dashboard-section">
        <div class="section-header">
          <h2>Recent Enquiries</h2>
          <a href="{{ url_for('admin_enquiries') }}" class="btn btn-secondary">View All</a>
        </div>
        <div class="table-responsive">
          <table class="admin-table">
            <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Property</th><th>Status</th><th>Date</th></tr></thead>
            <tbody>
              {% if enquiries and enquiries|length > 0 %}
                {% for enquiry in enquiries %}
                <tr>
                  <td>{{ enquiry.name }}</td>
                  <td>{{ enquiry.email }}</td>
                  <td>{{ enquiry.phone }}</td>
                  <td>
                    {% if enquiry.property %}
                      <a href="{{ url_for('property_detail', id=enquiry.property.id) }}">{{ enquiry.property.title[:30] }}{% if enquiry.property.title|length>30 %}...{% endif %}</a>
                    {% else %} General Enquiry {% endif %}
                  </td>
                  <td><span class="status-badge status-{{ enquiry.status.lower() }}">{{ enquiry.status }}</span></td>
                  <td>{{ enquiry.created_at.strftime('%d %b %Y') }}</td>
                </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="6" style="text-align:center;color:#777;">No recent enquiries.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="dashboard-section">
        <div class="section-header">
          <h2>Recent Bookings</h2>
          <a href="{{ url_for('admin_bookings') }}" class="btn btn-secondary">View All</a>
        </div>
        <div class="table-responsive">
          <table class="admin-table">
            <thead><tr><th>Visitor</th><th>Property</th><th>Date</th><th>Time</th><th>People</th><th>Status</th><th>Booked On</th></tr></thead>
            <tbody>
              {% if bookings and bookings|length > 0 %}
                {% for booking in bookings %}
                <tr>
                  <td>{{ booking.visitor_name }}</td>
                  <td>
                    {% if booking.property %}
                      <a href="{{ url_for('property_detail', id=booking.property.id) }}" target="_blank">{{ booking.property.title[:30] }}{% if booking.property.title|length>30 %}...{% endif %}</a>
                    {% else %} — {% endif %}
                  </td>
                  <td>{{ booking.booking_date.strftime('%d %b %Y') if booking.booking_date else '—' }}</td>
                  <td>{{ booking.booking_time }}</td>
                  <td>{{ booking.number_of_visitors }}</td>
                  <td><span class="status-badge status-{{ booking.status.lower() }}">{{ booking.status }}</span></td>
                  <td>{{ booking.created_at.strftime('%d %b %Y') }}</td>
                </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="7" style="text-align:center;color:#777;">No recent bookings.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </main>
</div>
{% endblock %}