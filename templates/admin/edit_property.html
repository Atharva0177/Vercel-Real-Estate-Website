{% extends 'base.html' %}

{% block title %}Edit Property - Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-user-shield"></i>
            <span>Admin Panel</span>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('admin_dashboard') }}" class="nav-item">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="{{ url_for('admin_properties') }}" class="nav-item active">
                <i class="fas fa-building"></i> Properties
            </a>
            <a href="{{ url_for('admin_add_property') }}" class="nav-item">
                <i class="fas fa-plus-circle"></i> Add Property
            </a>
            <a href="{{ url_for('admin_enquiries') }}" class="nav-item">
                <i class="fas fa-envelope"></i> Enquiries
            </a>
            <a href="{{ url_for('index') }}" class="nav-item">
                <i class="fas fa-globe"></i> View Website
            </a>
            <a href="{{ url_for('admin_logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
    </aside>
    
    <main class="admin-main">
        <div class="admin-header">
            <h1><i class="fas fa-edit"></i> Edit Property</h1>
        </div>
        
        <div class="admin-content">
            <div class="form-container">
                <form method="post" enctype="multipart/form-data" class="property-form">
                    {{ form.hidden_tag() }}
                    
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        
                        <div class="form-group">
                            <label>{{ form.title.label }}</label>
                            {{ form.title(class="form-control") }}
                        </div>
                        
                        <div class="form-group">
                            <label>{{ form.description.label }}</label>
                            {{ form.description(class="form-control", rows="5") }}
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ form.property_type.label }}</label>
                                {{ form.property_type(class="form-control") }}
                            </div>
                            
                            <div class="form-group">
                                <label>{{ form.status.label }}</label>
                                {{ form.status(class="form-control") }}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                {{ form.featured() }} Featured Property
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Pricing & Area</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ form.price.label }}</label>
                                {{ form.price(class="form-control") }}
                            </div>
                            
                            <div class="form-group">
                                <label>{{ form.area.label }}</label>
                                {{ form.area(class="form-control") }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Location Details</h3>
                        
                        <div class="form-group">
                            <label>{{ form.location.label }}</label>
                            {{ form.location(class="form-control") }}
                        </div>
                        
                        <div class="form-group">
                            <label>{{ form.address.label }}</label>
                            {{ form.address(class="form-control", rows="3") }}
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>{{ form.latitude.label }}</label>
                                {{ form.latitude(class="form-control") }}
                            </div>
                            
                            <div class="form-group">
                                <label>{{ form.longitude.label }}</label>
                                {{ form.longitude(class="form-control") }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Existing Images -->
                    {% if property.images %}
                    <div class="form-section">
                        <h3>Current Images</h3>
                        <div class="image-grid">
                            {% for image in property.images %}
                            <div class="image-item">
                                <img src="{{ url_for('static', filename=image.image_url) }}" alt="Property Image">
                                <button type="button" class="btn-delete-image" onclick="deleteImage({{ image.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="form-section">
                        <h3>Add More Images & Videos</h3>
                        
                        <div class="form-group">
                            <label>{{ form.images.label }}</label>
                            {{ form.images(class="form-control") }}
                            <p class="help-text">Upload additional images</p>
                        </div>
                        
                        <div class="form-group">
                            <label>{{ form.video_urls.label }}</label>
                            {{ form.video_urls(class="form-control", rows="4") }}
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> Update Property
                        </button>
                        <a href="{{ url_for('admin_properties') }}" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="button" class="btn btn-danger btn-lg" onclick="confirmDelete({{ property.id }})">
                            <i class="fas fa-trash"></i> Delete Property
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Confirm Deletion</h3>
        <p>Are you sure you want to delete this property? This action cannot be undone.</p>
        <div class="modal-actions">
            <form method="post" action="{{ url_for('admin_delete_property', id=property.id) }}" style="display: inline;">
                <button type="submit" class="btn btn-danger">Yes, Delete</button>
            </form>
            <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
function deleteImage(imageId) {
    if (confirm('Are you sure you want to delete this image?')) {
        fetch('/admin/image/delete/' + imageId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

function confirmDelete(propertyId) {
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('deleteModal').style.display = 'none';
}
</script>
{% endblock %}